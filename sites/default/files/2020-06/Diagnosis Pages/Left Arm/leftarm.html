<html>
    <body>

        <link rel="stylesheet" src="Stylesheet.css"/> 

        <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.0.min.js"></script>
        
        <!--can download these at https://github.com/jamietre/ImageMapster-->
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/redist/when.js"></script> 
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/redist/when.js"></script>
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/core.js"></script>
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/graphics.js"></script>
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/mapimage.js"></script>
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/mapdata.js"></script>
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/areadata.js"></script>
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/areacorners.js"></script>
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/scale.js"></script>
        <script type="text/javascript" src="/sites/default/files/2020-06/ImageMapster-master/src/tooltip.js"></script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

        <h1>
            
    <img src="Left arm.png" usemap="#image-map">


    <button name="therapy" onclick="match()" type="button">Get results</button> <!--insert therapy page url into href-->

    <map name="image-map">

    <!--Hand-->
    <area class="area" data-num="1" data-group="group_hand" target="" alt="" title="" href="#" coords="498,814,492,788,483,783,441,814,441,814,448,848,464,837,464,837,464,837" shape="poly">
    <area class="area" data-num="2" data-group="group_hand" target="" alt="" title="" href="#" coords="441,814,420,853,427,887,448,847" shape="poly">
    <area class="area" data-num="3" data-group="group_hand" target="" alt="" title="" href="#" coords="493,788,508,903,518,895,502,779" shape="poly">
    <area class="area" data-num="4" data-group="group_hand" target="" alt="" title="" href="#" coords="514,772,502,778,518,895,530,888" shape="poly">
    <area class="area" data-num="5" data-group="group_hand" target="" alt="" title="" href="#" coords="538,881,523,764,513,771,530,888" shape="poly">
    <area class="area" data-num="6" data-group="group_hand" target="" alt="" title="" href="#" coords="538,881,551,876,534,756,523,763" shape="poly">
    <area class="area" data-num="7" data-group="group_hand" target="" alt="" title="" href="#" coords="509,902,456,996,459,975,505,887" shape="poly">
    <area class="area" data-num="8" data-group="group_hand" target="" alt="" title="" href="#" coords="529,888,508,903,457,995,481,986" shape="poly">
    <area class="area" data-num="9" data-group="group_hand" target="" alt="" title="" href="#" coords="538,880,491,982,481,986,529,888" shape="poly">
    <area class="area" data-num="10" data-group="group_hand" target="" alt="" title="" href="#" coords="492,981,504,986,551,876,538,881" shape="poly">

    <!--Arm bottom - Forearm-->
    <area class="area" data-num="11" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="443,518,395,470,348,422,318,427,406,521" shape="poly">
    <area class="area" data-num="12" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="406,520,342,562,276,463,318,427" shape="poly">
    <area class="area" data-num="13" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="304,580,342,562,276,462,248,477" shape="poly">
    <area class="area" data-num="14" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="251,596,268,599,304,581,248,477,222,495,207,493" shape="poly">
    <area class="area" data-num="15" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="206,492,251,595,235,593,195,488" shape="poly">
    <area class="area" data-num="16" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="496,640,474,638,405,520,443,518,469,576" shape="poly">
    <area class="area" data-num="17" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="474,638,426,667,342,562,405,521" shape="poly">
    <area class="area" data-num="18" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="425,667,341,562,304,579,395,680" shape="poly">
    <area class="area" data-num="19" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="394,679,305,580,268,599,251,595,367,692" shape="poly">
    <area class="area" data-num="20" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="367,692,252,594,236,593" shape="poly">
    <area class="area" data-num="21" data-group="group_arm_bottom_-_forearm"  target="" alt="" title="" href="#" coords="534,756,531,757,474,638,496,640,534,756" shape="poly">
    <area class="area" data-num="22" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="514,772,531,757,474,638,426,667" shape="poly">
    <area class="area" data-num="23" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="425,667,395,680,503,779,514,772" shape="poly">
    <area class="area" data-num="24" data-group="group_arm_bottom_-_forearm" target="" alt="" title="" href="#" coords="503,779,492,788,367,692,394,679" shape="poly">

    <!--Arm Top -->
    <area class="area" data-num="25" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="348,423,318,427,224,259,262,248" shape="poly">
    <area class="area" data-num="26" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="224,259,197,287,297,445,318,427" shape="poly">
    <area class="area" data-num="27" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="276,462,297,445,197,287,169,314" shape="poly">
    <area class="area" data-num="28" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="248,477,276,461,169,314,137,342" shape="poly">
    <area class="area" data-num="29" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="104,370,137,342,248,478,222,495,206,493,88,370" shape="poly">
    <area class="area" data-num="30" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="194,490,206,492,88,369,74,372" shape="poly">
    <area class="area" data-num="31" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="262,248,206,177,165,195,223,259" shape="poly">
    <area class="area" data-num="32" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="224,259,165,194,124,214,170,314" shape="poly">
    <area class="area" data-num="33" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="169,313,124,214,92,281,104,371" shape="poly">
    <area class="area" data-num="34" data-group="group_arm_top_" target="" alt="" title="" href="#" coords="74,372,104,370,91,282,37,310" shape="poly">

    <!--Shoulder -->
    <area class="area" data-num="35" data-group="group_shoulder_" target="" alt="" title="" href="#" coords="206,177,186,186,28,35,21,10,113,93" shape="poly">
    <area class="area" data-num="36" data-group="group_shoulder_" target="" alt="" title="" href="#" coords="164,195,186,186,105,109,27,35,29,58,94,125" shape="poly">
    <area class="area" data-num="37" data-group="group_shoulder_" target="" alt="" title="" href="#" coords="162,194,124,215,77,183,33,151,28,58" shape="poly">
    <area class="area" data-num="38" data-group="group_shoulder_" target="" alt="" title="" href="#" coords="107,249,124,215,32,151,37,225" shape="poly">
    <area class="area" data-num="39" data-group="group_shoulder_" target="" alt="" title="" href="#" coords="92,281,106,249,37,226,35,310" shape="poly">

    </map>

    <script>

        const REQUIREMENT = 0.75;
        var init = false;
        var numGroups; //# of groups of polygons (i.e. left forehead)
        var groupPolys = new Array(); //# of polygons in each group
        var groupNames = new Array(); //names of each general area of the face
    
        var image = $('#leftarm');
        var imgElement = document.getElementById("leftarm");
      
        image.mapster({
          
          clickNavigate: true,
          mapKey: 'data-num',
    
          render_select: {
            fillColor: '0099ff',
            fillOpacity: 0.5,
            stroke: true,
            strokeColor: 'b3b3b3',
            strokeWidth: 1,
            fade: true,
            fadeDuration: 300
          },
    
          render_highlight: {
            fade: true,
            fadeDuration: 300
          },
    
        });
    
        function initData() {
    
          var facemap = document.querySelector("[name='" + imgElement.getAttribute("usemap").substr(1) + "']"); //the image map that the face image uses
          var areaList = Array.from(facemap.querySelectorAll("area")); //converting NodeList of area elements within facemap into an array
    
          for(i = 0; i < areaList.length; i++) {
            if(!groupNames.includes(areaList[i].getAttribute("data-group"))) {
              groupNames.push(areaList[i].getAttribute("data-group"));
            }
    
            if(groupPolys[groupNames.indexOf(areaList[i].getAttribute("data-group"))]){
              groupPolys[groupNames.indexOf(areaList[i].getAttribute("data-group"))] ++;
            } else {
              groupPolys[groupNames.indexOf(areaList[i].getAttribute("data-group"))] = 1;
            }
          }
    
          init = true;
    
        }
        
        function match() {
    
          if(!init) {
            initData();
          }
          
          numGroups = groupNames.length;
          var groupAreas = new Array(numGroups); //each index tracks # of polygons in each group that are selected (highlighted)
          var satisfied = false; //if the requirements have been met
          var treatmentArea = "";
          
          for(i = 0; i < groupAreas.length; i++) { //initialize the counter
            groupAreas[i] = 0;
          }
     
          for(i = 0; i < image.mapster('get').split(',').length && image.mapster('get').split(',')[0]; i++) {
            let group = "";
            group = document.querySelector("area[data-num=" + CSS.escape(image.mapster('get').split(',')[i]) + "]").getAttribute("data-group");
            groupAreas[groupNames.indexOf(group)]++; 
          }
           
          for(i = 0; i < groupAreas.length && satisfied == false; i++) {
            if((groupAreas[i] / groupPolys[i]) >= REQUIREMENT) { //check if at least 75% of the polygons in an area have been selected
              satisfied = true;
            } 
          }
          
          if(!satisfied) {
            swal("Alert!", "Select more regions to narrow down a specific treatment plan!", "error",  {
            button: "Back!"})
    
          } else {
            var indexOfMaxValue = groupAreas.reduce((iMax, x, i, array) => x > array[iMax] ? i : iMax, 0); // gets index of greatest value
            treatmentArea = groupNames[indexOfMaxValue];
    
            swal("Awesome!", (() => {
                var group = "";
                var string = treatmentArea.split("_").slice(1);
                for(i = 0; i < string.length; i++) {
                  group = group.concat(string[i].concat((i == string.length - 1) ? ":" :" "));
                }
                return("Get therapy for the ".concat(group));
              })(), 
              "success", 
              {
                buttons: {
                  reselect: {
                  text: "Reselect Areas",
                  value: null
                  },
                  proceed: {
                    text: "Proceed!",
                    value: "proceed"
                  }
                },
            }).then((choice) => {
              if(choice) {
                //transition to dashboard
                location.assign("dashboard.html");
              }
            });
          
          }
    
        }
    
      </script>

        </h1>
    </body>
</html>
